<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SignBridge ‚Äî Nemotron Agents</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 16px; }
    .grid { display: grid; gap: 16px; grid-template-columns: 1fr; }
    @media (min-width: 900px) { .grid { grid-template-columns: 1fr 1fr; } }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
    .log { background: #fafafa; border: 1px dashed #ccc; padding: 8px; height: 180px; overflow: auto; font: 12px/1.35 ui-monospace, monospace; white-space: pre-wrap;}
    button { padding: 8px 12px; border-radius: 8px; border: 1px solid #333; background: #fff; cursor: pointer; }
    audio { width: 100%; margin-top: 8px; }
    input[type="text"] { width: 100%; padding: 8px; border: 1px solid #aaa; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>SignBridge ‚Äî Nemotron Agents (VL + Function Calling)</h1>
  <div class="grid">
    <div class="card">
      <h2>üñêÔ∏è Sign ‚Üí üó£Ô∏è Speech</h2>
      <input id="signFile" type="file" accept="image/*"/>
      <button id="runSign">Run</button>
      <p><b>Plan:</b> <span id="plan1">‚Äî</span></p>
      <p><b>Final Text:</b> <span id="final1">‚Äî</span></p>
      <audio id="tts1" controls style="display:none"></audio>
      <div class="log" id="log1"></div>
    </div>

    <div class="card">
      <h2>üó£Ô∏è Speech ‚Üí ü§ü Sign</h2>
      <input id="speechText" type="text" placeholder="Type speech‚Ä¶"/>
      <button id="runSpeech">Run</button>
      <p><b>Plan:</b> <span id="plan2">‚Äî</span></p>
      <p><b>For Signing:</b> <span id="final2">‚Äî</span></p>
      <img id="signGif" style="max-width:100%;display:none" alt="sign gif"/>
      <div class="log" id="log2"></div>
    </div>
  </div>

  <script>
    const API="http://localhost:8000";
    const log=(el,m)=>{el.textContent+=m+"\n";el.scrollTop=el.scrollHeight};

    document.getElementById("runSign").onclick=async()=>{
      const f=document.getElementById("signFile").files[0];
      const L=document.getElementById("log1");
      L.textContent="";
      try{
        if(!f){ alert("Choose an image first"); return; }
        const fd=new FormData(); fd.append("file", f);
        const r=await fetch(API+"/run/sign_to_speech",{method:"POST",body:fd});
        if(!r.ok){
          const txt=await r.text();
          log(L, `HTTP ${r.status} ${r.statusText}`); log(L, txt);
          alert(`Backend error ${r.status}. See log box.`);
          return;
        }
        const d=await r.json();
        document.getElementById("plan1").textContent=d.plan||"(no plan)";
        document.getElementById("final1").textContent=d.final_text||"(‚Äî)";
        log(L, JSON.stringify({calls:d.calls, observations:d.observations}, null, 2));
        const a=document.getElementById("tts1");
        if(d.final_audio_b64){ a.src="data:audio/wav;base64,"+d.final_audio_b64; a.style.display="block"; }
        else { a.style.display="none"; }
      }catch(err){
        log(L, "JS error: "+(err?.message||err));
        alert("Frontend error ‚Äî check the log box and DevTools console.");
      }
    };

    document.getElementById("runSpeech").onclick=async()=>{
      const t=document.getElementById("speechText").value.trim();
      const L=document.getElementById("log2");
      L.textContent="";
      try{
        if(!t){ alert("Type some text"); return; }
        const r=await fetch(API+"/run/speech_to_sign",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({text:t})
        });
        if(!r.ok){
          const txt=await r.text();
          log(L, `HTTP ${r.status} ${r.statusText}`); log(L, txt);
          alert(`Backend error ${r.status}. See log box.`);
          return;
        }
        const d=await r.json();
        document.getElementById("plan2").textContent=d.plan||"(no plan)";
        document.getElementById("final2").textContent=d.final_text||"(‚Äî)";
        log(L, JSON.stringify({calls:d.calls, observations:d.observations}, null, 2));
        const gif=d.sign_animation_url||"";
        const img=document.getElementById("signGif");
        if(gif){ img.src=gif; img.style.display="block"; } else { img.style.display="none"; }
      }catch(err){
        log(L, "JS error: "+(err?.message||err));
        alert("Frontend error ‚Äî check the log box and DevTools console.");
      }
    };
  </script>
</body>
</html>